import * as XLSX from 'xlsx';
import * as path from 'path';
import * as fs from 'fs';
import { homedir } from 'os';

// ì‚¬ì—…ê³„íšì„œ ë°ì´í„° êµ¬ì¡°í™”
const businessPlanData: Record<string, (string | number)[][]> = {
  '1_ì‚¬ì—…ê°œìš”': [
    ['êµ¬ë¶„', 'ë‚´ìš©'],
    ['ì œí’ˆ', '7ê°€ì§€ AI ë„êµ¬ (ë¸”ë¡œê·¸, ë³´ê³ ì„œ, ì´ë¯¸ì§€, QR, ì´ë©”ì¼, í™˜ìœ¨, ì±—ë´‡)'],
    ['íƒ€ê²Ÿ', 'ë§ˆì¼€íŒ…Â·ê¸°íšÂ·ì˜ì—… ì§ì¥ì¸ (25-40ì„¸)'],
    ['ê°€ê²©', 'í¬ë ˆë”§ ê±´ë‹¹ ê²°ì œ (1C = 1,000ì›) + ì›” êµ¬ë… (ì˜ˆì •)'],
    ['í”Œë«í¼', 'ì›¹ ë¸Œë¼ìš°ì € (ëª¨ë°”ì¼ ìµœì í™”)'],
    ['ì°¨ë³„ì ', 'í•œê¸€ ì™„ë²½ ì§€ì› + ì˜¬ì¸ì› + ë…¸ì½”ë“œ + ì‚¬ìš©í•œ ë§Œí¼ë§Œ ê²°ì œ'],
  ],
  
  '2_ì œí’ˆì„œë¹„ìŠ¤': [
    ['ë„êµ¬', 'ê¸°ëŠ¥', 'ì‹œê°„ ì ˆì•½', 'ê°€ê²©', 'êµ¬í˜„ ìƒíƒœ'],
    ['ë¸”ë¡œê·¸ ìƒì„±ê¸°', 'SEO ìµœì í™” ë¸”ë¡œê·¸ ìë™ ì‘ì„±', '1ì‹œê°„ â†’ 10ë¶„', '3C', 'âœ…'],
    ['ë³´ê³ ì„œ ìƒì„±ê¸°', 'ìµœì‹  ë‰´ìŠ¤ ê¸°ë°˜ ì‚°ì—… ë³´ê³ ì„œ', '2ì‹œê°„ â†’ 15ë¶„', '5C', 'âœ…'],
    ['ì´ë¯¸ì§€ ê²€ìƒ‰', '3ê°œ API í†µí•© (300+ ì´ë¯¸ì§€)', '30ë¶„ â†’ 3ë¶„', '1C', 'âœ…'],
    ['QR ìƒì„±ê¸°', 'ëŒ€ëŸ‰ QR ìƒì„± + ë¡œê³  ì‚½ì…', '1ì‹œê°„ â†’ 5ë¶„', '2C', 'âœ…'],
    ['ì´ë©”ì¼ í…œí”Œë¦¿', 'ë¹„ì¦ˆë‹ˆìŠ¤ ì´ë©”ì¼ ìë™ ì‘ì„±', '30ë¶„ â†’ 5ë¶„', '1C', 'âœ…'],
    ['í™˜ìœ¨ ì•Œë¦¬ë¯¸', 'ë§¤ì¼ ìë™ í™˜ìœ¨ ì •ë³´ ì´ë©”ì¼', 'ë§¤ì¼ 10ë¶„', '2C', 'âœ…'],
    ['FRI ë§¤ë‰´ì–¼ë´‡', 'AI ì±—ë´‡ (RAG ê²€ìƒ‰)', '20ë¶„ â†’ 2ë¶„', '1C', 'âœ…'],
  ],
  
  '3_ì‹œì¥ë¶„ì„': [
    ['êµ¬ë¶„', 'ê·œëª¨', 'ì‹œì¥ ê·œëª¨'],
    ['TAM', '300ë§Œ ëª…', '1.8ì¡° ì›'],
    ['SAM', '60ë§Œ ëª…', '2,000ì–µ ì›'],
    ['SOM (1ì°¨ë…„ë„)', '5,000ëª…', '-'],
    ['SOM (2ì°¨ë…„ë„)', '15,000ëª…', '-'],
    ['SOM (3ì°¨ë…„ë„)', '40,000ëª…', '-'],
  ],
  
  '4_ë¹„ì¦ˆë‹ˆìŠ¤ëª¨ë¸': [
    ['íŒ¨í‚¤ì§€', 'ê°€ê²©', 'í¬ë ˆë”§', 'ë³´ë„ˆìŠ¤', '1Cë‹¹ ê°€ê²©', 'ì˜ˆìƒ êµ¬ë§¤ìœ¨'],
    ['ìŠ¤íƒ€í„°', '10,000ì›', '10C', '-', '1,000ì›', '30%'],
    ['ë² ì´ì§', '30,000ì›', '35C', '+5C', '857ì›', '50%'],
    ['í”„ë¡œ', '50,000ì›', '60C', '+10C', '833ì›', '15%'],
    ['í”„ë¦¬ë¯¸ì—„', '100,000ì›', '130C', '+30C', '769ì›', '5%'],
  ],
  
  '5_ìˆ˜ìµì˜ˆì¸¡_1ì°¨ë…„ë„': [
    ['ë¶„ê¸°', 'ê°€ì…ì', 'ìœ ë£Œ ì „í™˜ìœ¨', 'ìœ ë£Œ ì‚¬ìš©ì', 'ARPU', 'ì›” ë§¤ì¶œ', 'ë¶„ê¸° ë§¤ì¶œ'],
    ['Q1', '100', '10%', '10', '10,000ì›', '10ë§Œì›', '30ë§Œì›'],
    ['Q2', '300', '15%', '45', '15,000ì›', '68ë§Œì›', '200ë§Œì›'],
    ['Q3', '800', '20%', '160', '20,000ì›', '320ë§Œì›', '960ë§Œì›'],
    ['Q4', '2,000', '25%', '500', '25,000ì›', '1,250ë§Œì›', '3,750ë§Œì›'],
    ['ì—°ê°„ í•©ê³„', '3,200', '-', '715', '-', '-', '5,000ë§Œì›'],
  ],
  
  '6_ë¹„ìš©êµ¬ì¡°_1ì°¨ë…„ë„': [
    ['í•­ëª©', 'ì›”ë³„', 'ì—°ê°„', 'ë¹„ìœ¨', 'ì„¸ë¶€'],
    ['ì¸ê±´ë¹„', '1,250ë§Œì›', '1.5ì–µ', '60%', 'ëŒ€í‘œ 500 + ë§ˆì¼€í„° 450 + CS 300'],
    ['ë§ˆì¼€íŒ…', '150ë§Œì›', '1,800ë§Œì›', '18%', 'Meta 100 + SEO 50'],
    ['ì¸í”„ë¼/API', '80ë§Œì›', '960ë§Œì›', '10%', 'OpenAI 50 + Vercel 20 + ê¸°íƒ€ 10'],
    ['ì‚¬ë¬´ì‹¤', '70ë§Œì›', '840ë§Œì›', '8%', 'ì›” 50 + íšŒê³„/ë²•ë¬´ 20'],
    ['ì˜ˆë¹„ë¹„', '33ë§Œì›', '400ë§Œì›', '4%', 'ë¹„ìƒê¸ˆ'],
    ['í•©ê³„', '1,583ë§Œì›', '1.9ì–µì›', '100%', '-'],
  ],
  
  '7_ì†ìµê³„ì‚°ì„œ_1ì°¨ë…„ë„': [
    ['êµ¬ë¶„', 'Q1', 'Q2', 'Q3', 'Q4', 'ì—°ê°„'],
    ['ë§¤ì¶œ', '30ë§Œì›', '200ë§Œì›', '960ë§Œì›', '3,750ë§Œì›', '5,000ë§Œì›'],
    ['ë§¤ì¶œì›ê°€', '10ë§Œì›', '80ë§Œì›', '380ë§Œì›', '1,500ë§Œì›', '2,000ë§Œì›'],
    ['ë§¤ì¶œì´ì´ìµ', '20ë§Œì›', '120ë§Œì›', '580ë§Œì›', '2,250ë§Œì›', '3,000ë§Œì›'],
    ['íŒê´€ë¹„', '4,750ë§Œì›', '4,750ë§Œì›', '4,750ë§Œì›', '4,750ë§Œì›', '1.9ì–µì›'],
    ['ì˜ì—…ì´ìµ', '-4,730ë§Œì›', '-4,630ë§Œì›', '-4,170ë§Œì›', '-2,500ë§Œì›', '-1.6ì–µì›'],
  ],
  
  '8_ìê¸ˆì¡°ë‹¬ê³„íš': [
    ['ì¶œì²˜', 'ê¸ˆì•¡', 'ë¹„ìœ¨', 'ì¡°ë‹¬ ì‹œê¸°', 'ì¡°ê±´'],
    ['ì˜ˆë¹„ì°½ì—…íŒ¨í‚¤ì§€', '1ì–µì›', '40%', '0ê°œì›”', 'ì •ë¶€ ì§€ì›'],
    ['ìê¸°ìë³¸', '5,000ë§Œì›', '20%', '0ê°œì›”', 'ëŒ€í‘œ ì¶œì'],
    ['ì—”ì ¤/ì‹œë“œ', '5,000ë§Œì›', '20%', '3ê°œì›”', 'ì§€ë¶„ 8-10%'],
    ['K-Startup', '5,000ë§Œì›', '20%', '6ê°œì›”', 'ì •ë¶€ ì§€ì›'],
    ['í•©ê³„', '2.5ì–µì›', '100%', '-', '-'],
  ],
  
  '9_ë§ˆì¼ìŠ¤í†¤': [
    ['ì›”', 'í•µì‹¬ ëª©í‘œ', 'ë§¤ì¶œ', 'ì•¡ì…˜'],
    ['M1', 'ë² íƒ€ 50ëª…', '0ì›', 'ì»¤ë®¤ë‹ˆí‹° í™ë³´, í”¼ë“œë°± ìˆ˜ì§‘, ë§ˆì¼€í„° ì˜ì… ì‹œì‘'],
    ['M2', 'ë² íƒ€ 100ëª…', '50ë§Œì›', 'ìœ ë£Œ ì „í™˜ í…ŒìŠ¤íŠ¸, NPS ì¸¡ì •, íˆ¬ìì ë¯¸íŒ…'],
    ['M3', 'ì •ì‹ ëŸ°ì¹­', '150ë§Œì›', 'í”„ë ˆìŠ¤ ë¦´ë¦¬ìŠ¤, Meta ê´‘ê³ , ì—”ì ¤ íˆ¬ì ìœ ì¹˜'],
    ['M6', 'PMF ë‹¬ì„±', '500ë§Œì›', 'ì›” 500ë§Œì› ëŒíŒŒ, K-Startup ì§€ì›'],
    ['M10', 'ì†ìµë¶„ê¸°ì ', '1,600ë§Œì›', 'ìœ ë£Œ ì‚¬ìš©ì 800ëª…, B2B ì˜ì—…'],
    ['M12', 'Series A ì¤€ë¹„', '2,000ë§Œì›', 'IR í”¼ì¹˜ë±, ì‹¤ì  ìë£Œ'],
  ],
  
  '10_ì£¼ìš”KPI': [
    ['ì§€í‘œ', '1ê°œì›”', '3ê°œì›”', '6ê°œì›”', '12ê°œì›”'],
    ['ê°€ì…ì', '100', '300', '1,000', '5,000'],
    ['ìœ ë£Œ ì‚¬ìš©ì', '10', '50', '200', '1,250'],
    ['ì›” ë§¤ì¶œ', '10ë§Œì›', '150ë§Œì›', '500ë§Œì›', '2,000ë§Œì›'],
    ['NPS', '50+', '60+', '65+', '70+'],
    ['ìœ ë£Œ ì „í™˜ìœ¨', '10%', '17%', '20%', '25%'],
  ],
};

// ì—‘ì…€ íŒŒì¼ ìƒì„±
function createExcelFile() {
  const workbook = XLSX.utils.book_new();
  
  // ê° ì‹œíŠ¸ ìƒì„±
  Object.entries(businessPlanData).forEach(([sheetName, data]) => {
    const worksheet = XLSX.utils.aoa_to_sheet(data);
    
    // ì—´ ë„ˆë¹„ ìë™ ì¡°ì •
    const colWidths = data[0].map((_, colIndex) => {
      const maxLength = Math.max(
        ...data.map(row => String(row[colIndex] || '').length)
      );
      return { wch: Math.min(maxLength + 2, 50) };
    });
    worksheet['!cols'] = colWidths;
    
    // ì‹œíŠ¸ ì´ë¦„ì€ ì´ë¯¸ ì•ˆì „í•˜ê²Œ ì„¤ì •ë¨
    XLSX.utils.book_append_sheet(workbook, worksheet, sheetName);
  });
  
  // ë°”íƒ•í™”ë©´ ê²½ë¡œ (OneDrive í¬í•¨)
  let desktopPath = '';
  try {
    // PowerShellë¡œ ì‹¤ì œ ë°”íƒ•í™”ë©´ ê²½ë¡œ ê°€ì ¸ì˜¤ê¸°
    const { execSync } = require('child_process');
    desktopPath = execSync('powershell -Command "[Environment]::GetFolderPath(\'Desktop\')"', { encoding: 'utf-8' }).trim();
  } catch (error) {
    // ì‹¤íŒ¨ ì‹œ ê¸°ë³¸ ê²½ë¡œ ì‚¬ìš©
    desktopPath = path.join(homedir(), 'Desktop');
  }
  
  // ë””ë ‰í† ë¦¬ê°€ ì—†ìœ¼ë©´ ìƒì„±
  if (!fs.existsSync(desktopPath)) {
    fs.mkdirSync(desktopPath, { recursive: true });
  }
  
  const today = new Date().toISOString().split('T')[0];
  const fileName = `WorkFree_ì‚¬ì—…ê³„íšì„œ_${today}.xlsx`;
  
  // 1. ë°”íƒ•í™”ë©´ì— ì €ì¥
  const desktopFilePath = path.join(desktopPath, fileName);
  XLSX.writeFile(workbook, desktopFilePath);
  
  // 2. í”„ë¡œì íŠ¸ ë£¨íŠ¸ì—ë„ ì €ì¥ (ë°”ë¡œ í™•ì¸ ê°€ëŠ¥)
  const projectFilePath = path.join(process.cwd(), fileName);
  XLSX.writeFile(workbook, projectFilePath);
  
  console.log(`\nâœ… ì—‘ì…€ íŒŒì¼ ìƒì„± ì™„ë£Œ!`);
  console.log(`ğŸ“ ë°”íƒ•í™”ë©´: ${desktopFilePath}`);
  console.log(`ğŸ“ í”„ë¡œì íŠ¸ í´ë”: ${projectFilePath}`);
  console.log(`\nğŸ’¡ í”„ë¡œì íŠ¸ í´ë”ì—ì„œ ë°”ë¡œ í™•ì¸í•˜ì„¸ìš”!`);
  
  return { desktop: desktopFilePath, project: projectFilePath };
}

// ì‹¤í–‰
try {
  const filePath = createExcelFile();
  console.log(`\nğŸ“ íŒŒì¼ ìœ„ì¹˜: ${filePath}`);
  console.log(`\nğŸ‰ ë°”íƒ•í™”ë©´ì—ì„œ í™•ì¸í•˜ì„¸ìš”!`);
} catch (error) {
  console.error('âŒ ì˜¤ë¥˜ ë°œìƒ:', error);
  process.exit(1);
}

